@{
    Layout = "_StudentLayout";
    ViewData["Title"] = "Dashboard";
}

<link rel="stylesheet" href="~/css/student.css" />

<div class="dashboard-bg py-1">
    <div class="container-fluid dashboard-container">
        <!-- ===== TASKS CHART + TOTAL TASK CARD ===== -->
        <div class="row g-4">
            <!-- Task Completed Chart -->
            <div class="col-12 col-lg-8">
                <div class="card chart-card p-3" style="height:380px; overflow-x:auto; overflow-y:hidden;">
                    <div style="width:1200px;">
                        <canvas id="studentTasksChart" style="width:100%; height:300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Total Tasks Card -->
            <div class="col-12 col-lg-4">
                <div class="card shadow-sm p-3 text-center d-flex flex-column justify-content-center" style="height:380px;">
                    <h5 class="fw-bold mb-3" id="totalTasksTitle">Total Tasks Completed</h5>
                    <p class="display-1 fw-bold text-primary mb-0" id="totalTasksNumber">0</p>
                </div>
            </div>
        </div>

        <!-- ===== TASK FREQUENCY CHART (FULL WIDTH) ===== -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card chart-card p-3" style="height:380px;">
                    <div style="height:300px;">
                        <canvas id="taskFrequencyChart" style="width:100%; height:100%;"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global Chart defaults
        Chart.defaults.font.family = 'Segoe UI';
        Chart.defaults.color = '#666';

        // Bar style
        const premiumBarStyle = {
            borderRadius: 8,
            barPercentage: 0.9,
            categoryPercentage: 0.9,
            maxBarThickness: 60
        };

        // Task Completed Chart Options (horizontal scroll)
        const taskCompletedOptions = {
            responsive: false,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: {
                y: { beginAtZero: true, grid: { color: "rgba(0,0,0,0.05)" } },
                x: { grid: { display: false } }
            }
        };

        // Task Frequency Chart Options (full width)
        const taskFrequencyOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: {
                y: { beginAtZero: true, grid: { color: "rgba(0,0,0,0.05)" } },
                x: { grid: { display: false } }
            }
        };

        // Chart Data
        const taskCompletedData = [5, 8, 12, 7, 9, 10, 15, 6, 8, 11, 7, 10];
        const taskFrequencyData = [2, 3, 5, 3, 4, 5, 6, 3, 4, 5, 3, 4];
        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

        // Determine current month
        const currentDate = new Date();
        const currentMonthIndex = currentDate.getMonth(); // 0-based index
        const currentMonthName = months[currentMonthIndex];

        // Update Total Tasks Card dynamically
        document.getElementById('totalTasksTitle').textContent = `Total Tasks Completed in ${currentMonthName}`;
        document.getElementById('totalTasksNumber').textContent = taskCompletedData[currentMonthIndex];

        // Task Completed Chart
        const ctxTasks = document.getElementById('studentTasksChart').getContext('2d');
        const studentTasksChart = new Chart(ctxTasks, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'Task Completed',
                    data: taskCompletedData,
                    backgroundColor: '#55D2FF', // blue
                    borderColor: '#55D2FF',
                    ...premiumBarStyle
                }]
            },
            options: taskCompletedOptions
        });

        // Task Frequency Chart
        const ctxFreq = document.getElementById('taskFrequencyChart').getContext('2d');
        const taskFrequencyChart = new Chart(ctxFreq, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'Task Frequency',
                    data: taskFrequencyData,
                    backgroundColor: '#E590FA', // pink/purple
                    borderColor: '#E590FA',
                    ...premiumBarStyle
                }]
            },
            options: taskFrequencyOptions
        });
    </script>
}
